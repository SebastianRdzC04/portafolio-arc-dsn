---
import WorkLayout from '../../layouts/WorkLayout.astro';
import { getCollection, render } from 'astro:content';
import { parseWorkId } from '../../lib/utils';
import type { GetStaticPaths, InferGetStaticPropsType } from 'astro';

export const getStaticPaths = (async () => {
  const allWorks = await getCollection('trabajos', ({ data }) => !data.draft);

  return allWorks.map((entry) => {
    const parsed = parseWorkId(entry.id);
    // URL: /<subject>/<unit>/<work>/<file>
    const slug = `${parsed.unit}/${parsed.work}/${parsed.file}`;
    return {
      params: { subject: parsed.subject, slug },
      props: { entry, parsed },
    };
  });
}) satisfies GetStaticPaths;

type Props = InferGetStaticPropsType<typeof getStaticPaths>;

const { entry, parsed } = Astro.props as Props;
const { Content } = await render(entry);
---

<WorkLayout
  title={entry.data.title}
  description={entry.data.description}
  date={entry.data.date}
  tags={entry.data.tags}
  subjectSlug={parsed.subject}
  unitSlug={parsed.unit}
>
  <Content />
</WorkLayout>
